# 💕 表白网站 - 升级版

一个具有用户认证、设备检测和管理功能的浪漫表白网站。

## 🆕 新功能

### 1. 用户认证系统
- **用户注册/登录**：支持用户名、密码和邮箱注册
- **设备指纹检测**：自动检测新设备，防止重复同意
- **JWT Token认证**：安全的用户身份验证
- **会话管理**：自动保存登录状态

### 2. 权限控制系统
- **白名单功能**：只有白名单用户才能使用网站
- **黑名单功能**：黑名单用户无法访问网站
- **管理员权限**：管理员可以管理用户和记录

### 3. 数据管理
- **服务器端存储**：同意时间存储在服务器，跨设备同步
- **设备绑定**：每个用户的设备指纹会被记录
- **防重复操作**：已同意用户无法重复点击同意

### 4. 管理员面板
- **用户管理**：查看、启用/禁用用户
- **白名单管理**：添加/移除白名单用户
- **黑名单管理**：添加/移除黑名单用户
- **记录管理**：查看和删除用户记录
- **统计信息**：用户和记录统计

## 🚀 快速开始

### 安装依赖

```bash
# Python版本
cd server_py
pip install -r requirements.txt

# Node.js版本
cd server
npm install
```

### 启动服务器

```bash
# Python版本（推荐）
cd server_py
python app.py

# Node.js版本
cd server
npm start
```

### 访问网站

- **主网站**：http://localhost:8000
- **管理员面板**：http://localhost:8000/admin.html

## 📋 使用说明

### 普通用户

1. **首次访问**：
   - 点击"登录/注册"按钮
   - 选择注册新账号或登录现有账号
   - 填写用户名、密码等信息

2. **同意表白**：
   - 登录后点击"愿意"按钮
   - 系统会记录同意时间到服务器
   - 开始计时和记录功能

3. **跨设备使用**：
   - 在新设备上登录相同账号
   - 系统会自动同步同意状态
   - 无需重复同意

### 管理员

1. **登录管理员面板**：
   - 访问 `/admin.html`
   - 使用管理员账号登录（默认：admin）

2. **管理用户**：
   - 查看所有用户列表
   - 启用/禁用用户账号
   - 添加用户到黑名单

3. **管理权限**：
   - 添加用户到白名单
   - 从黑名单移除用户
   - 查看用户统计信息

## 🔧 配置说明

### 环境变量

```bash
# JWT密钥（可选，默认使用内置密钥）
export JWT_SECRET="your_secret_key"

# 服务器端口（可选，默认8000）
export PORT=8000
```

### 数据库文件

- **用户数据**：`server_py/local2/auth.json`
- **记录数据**：`server_py/local2/records.json`
- **上传文件**：`server_py/local2/uploads/`

## 🛡️ 安全特性

1. **密码加密**：使用Werkzeug安全哈希
2. **JWT Token**：安全的用户认证
3. **设备指纹**：防止恶意重复操作
4. **输入验证**：防止XSS和注入攻击
5. **文件类型检查**：限制上传文件类型
6. **路径安全**：防止目录遍历攻击

## 📱 设备检测

系统会自动生成设备指纹，包含：
- 用户代理字符串
- 屏幕分辨率
- 时区信息
- 语言设置

每个用户的设备指纹会被记录，确保：
- 新设备需要重新登录
- 防止重复同意操作
- 跨设备数据同步

## 🔄 数据同步

- **同意时间**：存储在服务器，跨设备同步
- **用户记录**：所有记录保存在服务器
- **设备绑定**：自动绑定用户设备
- **状态同步**：登录状态自动同步

## 🎯 解决的问题

### 问题1：重复同意
- ✅ 用户认证系统防止重复操作
- ✅ 设备指纹检测新设备
- ✅ 服务器端存储同意时间

### 问题2：数据管理
- ✅ 完整的用户管理系统
- ✅ 白名单/黑名单权限控制
- ✅ 管理员面板统一管理
- ✅ 详细的统计和监控

## 📞 技术支持

如有问题或建议，请联系开发者。

---

💕 愿每一份爱都能被好好记录和珍惜 💕